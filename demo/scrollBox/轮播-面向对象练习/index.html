<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>轮播(面向对象练习)</title>
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
   <div id="wrap">
       <ul class="slide">
           <li>
                <a href="#">
                    <img src="images/01.jpeg" alt="01">
                </a>
           </li>
                  <li>
                <a href="#">
                    <img src="images/02.jpeg" alt="02">
                </a>
           </li>
                  <li>
                <a href="#">
                    <img src="images/03.jpeg" alt="03">
                </a>
           </li>
                  <li>
                <a href="#">
                    <img src="images/04.jpeg" alt="04">
                </a>
           </li>
                  <li>
                <a href="#">
                    <img src="images/05.jpeg" alt="05">
                </a>
           </li>
       </ul>
       <div id="controls">
           <span class="on">1</span>
           <span>2</span>
           <span>3</span>
           <span>4</span>
           <span>5</span>
       </div>
       <a href="#" class="prev">&lt;</a>
       <a href="#" class="next">&gt;</a>
   </div>
   <script>
       (function () {
           function ScrollBox(box) {
               this.box =box;
               this.init();
           }
           ScrollBox.prototype={
               init:function () {
                 this.wrap =this.$(this.box);
                 this.slideBox = this.$(".slide",this.wrap)[0];
                 this.tab =this.wrap.getElementsByTagName("span");
                 this.prev =this.$(".prev",this.wrap)[0];
                 this.next =this.$(".next",this.wrap)[0];
                 this.offWidth =this.wrap.offsetWidth;
                 this.len =this.tab.length;
                 this.now =0;
                 this.timer =null;
                 this.initCur();
               },
               initCur:function () {
                   var _this = this;

                   this.timer=setInterval(auto,3000);

                   for(var i=0;i<this.len;i++){
                       this.tab[i].index =i;
                       this.tab[i].onmouseover=function () {
                           _this.play(this.index);
                       }
                   }

                   this.wrap.onmouseover =function () {
                       clearInterval(_this.timer);
                   };
                   this.wrap.onmouseout =function () {
                       _this.timer =setInterval(auto,3000);
                   };
                   this.next.onclick =function () {
                       auto();
                       console.log(_this.now);
                   };
                   this.prev.onclick = function () {
                       if(_this.now>0){
                           _this.now--;
                       }else{
                           _this.now =_this.len -1;
                           _this.scrollBox.style.left= -(_this.offWidth * _this.len) +"px";

                       }
                       _this.play(_this.now);
                   };

                   function auto(){
                       _this.now++;
                       (_this.now==_this.len )&& (_this.now=0);
                       _this.play(_this.now);

                   }

               },

               play:function (cur) {
                   for(var i=0;i<this.len;i++){
                       this.tab[i].className ="";
                   }
                   this.tab[cur].className +="on";
                   this.move(this.slideBox,"left",-this.offWidth*cur);
                   this.now =cur;
               },
               move:function (obj,attr,target) {
                   var _this =this;
                   clearInterval(obj.timer);
                   obj.timer =setInterval(function () {
                       var stop= true;
                       var cur =parseInt(parseFloat(_this.getCss(obj,attr)));
                       var speed =(target - cur)/8;
                       speed =speed > 0 ?Math.ceil(speed) : Math.floor(speed);
                       if(cur !==target){
                           stop =false;
                           obj.style.left =cur + speed +"px";
                       }
                       if(stop){
                           clearInterval(obj.timer);
                       }
                   },30)
               },
               getCss:function (obj,attr) {
                   if(obj.currentStyle){
                       return obj.currentStyle[attr];
                   }else{
                       return getComputedStyle(obj,null)[attr];
                   }
               },
               $:function (str,obj) {
                   if(str.indexOf("#") !==-1){
                       str =str.replace("#","");
                       if(document.getElementById){
                           return (obj||document).getElementById(str);
                       }
                   }else if(str.indexOf(".") !==-1){
                       str =str.replace(".","");
                       if(document.getElementsByClassName){
                           return (obj||document).getElementsByClassName(str);
                       }else{
                           var ele =(obj||document).getElementsByTagName("*");
                           var reg =new RegExp("(^|\\s)"+str+"($|\\s)"),
                               arr =[];
                           for(var i=0,len= ele.length;i<len;i++){
                               if(reg.test(ele[i].className)){
                                   arr.push(ele[i]);
                               }
                           }
                           return arr;
                       }
                   }
               }
           };
           new ScrollBox("#wrap");
       })();
   </script>
</body>
</html>